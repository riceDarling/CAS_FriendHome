<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<link href="css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="css/common.css" />
		<style type="text/css">
			#map {
				height: 50%;
				width: 100%;
				position: fixed;
				top: 80px;
				bottom: 0px;
				line-height: 200px;
				text-align: center;
				background: #FFFFFF;
			}
		</style>
	</head>

	<body>
		<header id="header" class="mui-bar mui-bar-nav background_lv">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" onclick="closeme();"></a>
			<h1 class="mui-title">友爱家园</h1>
		</header>
		<div id="pullrefresh" class="mui-content">
			<div class="mui-input-row mui-search" style="margin-top: 46px;">
				<input id="mui-searchVal" type="search" class="mui-input-clear" placeholder="请输入...">
				<!--<a class="mui-icon mui-icon-search mui-pull-right" style="color: #ccc;"></a>-->
			</div>

			<div id="map">地图加载中...</div>
		</div>
		<nav class="mui-bar mui-bar-tab background_lv">
			<a class="mui-tab-item back_id_lv" href="index.html">
				<span class="mui-icon mui-icon-home"></span>
				<span class="mui-tab-label">首页</span>
			</a>
			<a class="mui-tab-item" href="news.html">
				<span class="mui-icon mui-icon-compose"></span>
				<span class="mui-tab-label">新闻</span>
			</a>
			<a class="mui-tab-item" href="shop.html">
				<span class="mui-icon mui-icon-flag"></span>
				<span class="mui-tab-label">商城</span>
			</a>
			<a class="mui-tab-item" href="user.html">
				<span class="mui-icon mui-icon-contact"></span>
				<span class="mui-tab-label">个人</span>
			</a>
		</nav>
	</body>
	<script src="js/mui.min.js"></script>
	<script type="text/javascript">
		var em = null,
			map = null;
		// H5 plus事件处理
		function plusReady() {
			// 确保DOM解析完成
			if(!em || !window.plus || map) {
				return
			};
			map = new plus.maps.Map("map");
		}
		if(window.plus) {
			plusReady();
		} else {
			document.addEventListener("plusready", plusReady, false);
		}
		// DOMContentloaded事件处理
		document.addEventListener("DOMContentLoaded", function() {
			em = document.getElementById("map");
			plusReady();
		}, false);

		/*// 关闭自身窗口
		function closeme() {
			var ws = plus.webview.currentWebview();
			plus.webview.close(ws);
		}*/
		

		var searchObj = new plus.maps.Search(map);
		searchObj.onPoiSearchComplete = function(state, result) {
			console.log("onPoiSearchComplete: " + state + " , " + result.currentNumber);
			if(state == 0) {
				if(result.currentNumber <= 0) {
					alert("没有检索到结果");
				}
				for(var i = 0; i < result.currentNumber; i++) {
					var pos = result.getPosition(i);
					var marker = new plus.maps.Marker(pos.point);
					marker.setLabel(pos.name);
					map.addOverlay(marker);
				}
			} else {
				alert("检索失败");
			}
		}
		var pt = new plus.maps.Point(116.404, 39.915); // 天安门坐标
		searchObj.poiSearchNearBy(mui('#mui-searchVal')[0].value, pt, 1000);
		
		
		/*document.getElementById("mui-searchVal").addEventListener('input', function() {
			console.log(mui('#mui-searchVal')[0].value);
		});*/
	</script>

</html>